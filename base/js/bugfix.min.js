(function(a){function j(b){var c=Math.floor(b/3600);var d=Math.floor(b%3600/60);var e=b%60;var f=a.map([c,d,e],function(a){if(a<10){return"0"+a}return""+a});return f.join(":")}function k(){a.ajax({data:a.stringifyJSON({action:"load_submissions"}),success:function(b){if(b["success"]){var c=a("<tbody>");var e=0;a.each(b["submissions"],function(b,d){var f=a("<tr>").append(a("<td>").text(j(d["time_submitted"]-contestStartTime))).append(a("<td>").text(d["alias"])).append(a("<td>").text(d["title"])).append(a("<td>").text(d["message"]));if(d["judgment"]==judgmentCorrect){f.addClass("correct")}else if(d["judgment"]==judgmentIncorrect){f.addClass("incorrect")}else{f.addClass("pending");e++}c.append(f)});if(e==0&&b["submissions"].length!=0){clearInterval(d);d=setInterval(k,18e4);l()}else if(e!=0){clearInterval(d);d=setInterval(k,5e3)}a("#submissions_table > tbody").replaceWith(c)}}})}function l(){a.ajax({data:a.stringifyJSON({action:"load_scoreboard"}),success:function(b){if(b["success"]){var c=b["scoreboard"];var d=a("<tr>").append(a("<th>").text("Rank")).append(a("<th>").text("Team"));a.each(c["problems"],function(b,c){d.append(a("<th>").text(c["alias"]))});d.append(a("<th>").text("Score"));var e=a("<tbody>");a.each(c["teams"],function(b,c){var d=a("<tr>").append(a("<td>").text(b+1)).append(a("<td>").text(c["alias"]));if(c.hasOwnProperty("me")){d.addClass("me")}a.each(c["judgments"],function(b,c){var e=a("<td>").text(" ");if(c==judgmentCorrect){e.addClass("correct")}else if(c==judgmentIncorrect){e.addClass("incorrect")}d.append(e)});d.append(a("<td>").text(c["score"]));e.append(d)});a("#scoreboard_table > thead").replaceWith(a("<thead>").append(d));a("#scoreboard_table > tbody").replaceWith(e)}}})}function m(){var a=new Date;return a.getTime()/1e3}function n(){var d=m();a.get("time.php",function(a){var e=m();var f=d+(e-d)/2;var g=parseFloat(a);var i=g-f;b=(b*c+i)/(c+1);c++;if(c<5){setTimeout(n,1e3+Math.floor(Math.random()*1e4))}if(h==0){h=setInterval(o,500)}o()})}function o(){var b=m();if(b<contestEndTime){var c=0;var d;if(b<contestStartTime){c=Math.ceil(contestStartTime-b);d="start";i=false}else{c=Math.ceil(contestEndTime-b);d="end";if(!a("#problems_listing").is(":visible")){a("#problems_listing").load("problems.php").show()}i=true}a("#timer").text(j(c)+" until "+d)}else{i=false;a("#timer").text("Contest is over").addClass("expired")}if(b>=scoreboardFreezeTime&&e!=0){clearInterval(e);e=0;a("#scoreboard_table_div .div_title").text("Scoreboard (frozen)")}}function p(a){return a.substr(a.indexOf(":")-2,8)}function q(){a.ajax({data:a.stringifyJSON({action:"get_clarifications"}),success:function(b){if(b["success"]){var c=a("<div>");a.each(b["clarifications"],function(b,d){var e=p((new Date(d["time_posted"]*1e3)).toTimeString());var f="";var g="";switch(d["type"]){case postBroadcast:f="Broadcast message";g="broadcast";break;case postReply:f="Reply";g="reply";break;default:f="Asked";g="asked";break}c.append(a("<div>").addClass(g).append(a("<h5>").text(f+" at "+e)).append(a("<span>").text(d["text"])))});a("#messages").empty().append(c)}}})}function r(b){if(g!=0){clearTimeout(g);g=0}a("#submissions_upload_status").text(b);g=setTimeout(function(){a("#submissions_upload_status").text("Select a file");g=0},3e3)}var b=0;var c=0;var d=0;var e=0;var f=0;var g=0;var h=0;var i=false;a(document).ready(function(){a.ajaxSetup({url:"handle.php",type:"post",jsonp:false,processData:false,dataType:"json"});a("#problems_listing").hide();n();a("#submissions_upload").upload({name:"team_file",action:"handlefile.php",autoSubmit:false,params:{action:"upload_submission",MAX_FILE_SIZE:1e6},onSelect:function(){if(!i){r("Contest closed")}var a=this.filename().replace(/.*(\/|\\)(.*)/g,"$2");if(a.match(/\.(c|java|cc|cpp|py)$/)){this.submit()}else{r("Invalid extension")}},onComplete:function(b){ret=a.parseJSON(b);if(ret["success"]){r(ret["filename"]+" submitted");k()}else{r(ret["error"])}}});a("#ask_submit").click(function(){var b=a.trim(a("#ask_message").val());if(b){a.ajax({data:a.stringifyJSON({action:"post_clarification",message:b}),success:q});a("#ask_message").val("")}return false});d=setInterval(k,3e5);k();e=setInterval(l,3e4);l();f=setInterval(q,3e4);q()})})(window.jQuery)